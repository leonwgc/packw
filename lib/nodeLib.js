"use strict";var __importDefault=function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.injectHtml=exports.getNodeLib=void 0;var pack_1=require("./pack"),chalk_1=__importDefault(require("chalk")),path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),webpack_1=__importDefault(require("webpack")),process_1=__importDefault(require("process")),webpack_node_externals_1=__importDefault(require("webpack-node-externals")),cheerio_1=__importDefault(require("cheerio")),webpack_merge_1=__importDefault(require("webpack-merge")),process_2=require("process"),getProjectPath=function(a){return void 0===a&&(a="./"),path_1.default.join(process_1.default.cwd(),a)},getNodeLib=function(a,b,c){"function"==typeof b&&(c=b,b="./ssr-lib");var d=(0,pack_1.getWebpackConfig)(!1,a,"","node"),e={entry:a,externals:[(0,webpack_node_externals_1.default)()],output:{path:getProjectPath(b),filename:"[name].js",library:{type:"commonjs2"}}},f=(0,webpack_merge_1.default)({},d,e),g=(0,webpack_1.default)(f);g.run(function(a,b){(a||b.hasErrors())&&console.log(a.stack||a.message||a),g.close(function(){console.log(chalk_1.default.green("successfully build!")),null===c||void 0===c?void 0:c()})})};exports.getNodeLib=getNodeLib;/**
 * Inject html to html root node for hydration.
 * @param {string} htmlFile HTML file path
 * @param {string} [htmlContent=''] HTML content that will be injected.
 * @param {string} [rootSelector='#root'] Hydration root html element selector, default #root
 */var injectHtml=function(a,b,c){if(void 0===b&&(b=""),void 0===c&&(c="#root"),fs_1.default.existsSync(a))try{var d=fs_1.default.readFileSync(a,{encoding:"utf-8"}),e=cheerio_1.default.load(d);e(c).html(b),fs_1.default.writeFileSync(a,e.html())}catch(a){console.error(a),(0,process_2.exit)(1)}else console.error(a+"does not exist")};exports.injectHtml=injectHtml;
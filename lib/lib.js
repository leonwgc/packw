"use strict";var __importDefault=function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.injectHtmlToRootNode=exports.getSsrLib=void 0;var pack_1=require("./pack"),chalk_1=__importDefault(require("chalk")),path_1=__importDefault(require("path")),fs_1=__importDefault(require("fs")),webpack_1=__importDefault(require("webpack")),webpack_node_externals_1=__importDefault(require("webpack-node-externals")),cheerio_1=__importDefault(require("cheerio")),webpack_merge_1=__importDefault(require("webpack-merge")),process_1=require("process"),getProjectPath=function(a){return void 0===a&&(a="./"),path_1.default.join(process.cwd(),a)},getSsrLib=function(a,b){var c=(0,pack_1.getWebpackConfig)(!1,a,"","node"),d={entry:a,externals:[(0,webpack_node_externals_1.default)()],output:{path:getProjectPath("./ssr-lib"),filename:"[name].js",library:{type:"commonjs2"}}},e=(0,webpack_merge_1.default)({},c,d),f=(0,webpack_1.default)(e);f.run(function(a,c){(a||c.hasErrors())&&console.log(a.stack||a.message||a),f.close(function(){console.log(chalk_1.default.green("\u5E93\u6784\u5EFA\u5B8C\u6210")),null===b||void 0===b?void 0:b()})})};exports.getSsrLib=getSsrLib;/**
 *
 *
 * @param {string} htmlFilePath 文件路径
 * @param {string} [html=''] 注入的html
 * @param {string} [rootSelector='#root'] 注入到的html element 元素, 比如ReactDOM render的root container
 */var injectHtmlToRootNode=function(a,b,c){if(void 0===b&&(b=""),void 0===c&&(c="#root"),fs_1.default.existsSync(a))try{var d=fs_1.default.readFileSync(a,{encoding:"utf-8"}),e=cheerio_1.default.load(d);e(c).html(b),fs_1.default.writeFileSync(a,e.html())}catch(a){console.error(a),(0,process_1.exit)(1)}else console.error(a+" not exist")};exports.injectHtmlToRootNode=injectHtmlToRootNode;